# Namespace
namespace: service

create:
  namespace: true

# Elasticsearch config
elasticsearch:
  enabled: true
  image: docker.elastic.co/elasticsearch/elasticsearch:8.15.0
  replicaCount: 3

  service:
    type: ClusterIP
    httpPort: 9200
    transportPort: 9300

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  persistence:
    enabled: true
    storageClass: standard
    size: 10Gi
    mountPath: /usr/share/elasticsearch/data

  # Java heap (set to half of memory limit)
  javaOpts: "-Xms1g -Xmx1g"

  # Cluster settings
  clusterName: "elk-logging"
  minimumMasterNodes: 2

  # X-Pack security (basic, free tier)
  security:
    enabled: true
    password: "changeme"
    transportSsl: false
    httpSsl: false

  # ILM (Index Lifecycle Management)
  ilm:
    enabled: true
    hotMaxAge: 7d
    hotMaxSize: 10gb
    warmMaxAge: 30d
    deleteMinAge: 90d

  # Anti-affinity for HA
  antiAffinity:
    enabled: true
    type: preferredDuringSchedulingIgnoredDuringExecution

  # Init container for vm.max_map_count sysctl tuning
  sysctlInit:
    enabled: true

  # PodDisruptionBudget
  pdb:
    enabled: true
    minAvailable: 2

# Logstash config
logstash:
  enabled: true
  image: docker.elastic.co/logstash/logstash:8.15.0
  replicaCount: 1

  service:
    type: ClusterIP
    beatsPort: 5044
    httpPort: 9600

  resources:
    limits:
      cpu: 1000m
      memory: 1536Mi
    requests:
      cpu: 500m
      memory: 768Mi

  javaOpts: "-Xms512m -Xmx512m"

  persistence:
    enabled: true
    storageClass: standard
    size: 2Gi
    mountPath: /usr/share/logstash/data

  # Loki forwarding (optional dual output)
  lokiForwarding:
    enabled: false
    url: "http://loki.service.svc.cluster.local:3100"

# Kibana config
kibana:
  enabled: true
  image: docker.elastic.co/kibana/kibana:8.15.0
  replicaCount: 1

  service:
    type: ClusterIP
    port: 5601

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  # Encryption keys
  encryptionKey: "changeme-32-char-encryption-key!"
  savedObjectsEncryptionKey: "changeme-32-char-saved-objects!!"
  reportingEncryptionKey: "changeme-32-char-reporting-key!!"

# Filebeat config (DaemonSet log collector)
filebeat:
  enabled: true
  image: docker.elastic.co/beats/filebeat:8.15.0

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Output target: "elasticsearch" or "logstash"
  output: logstash

# Ingress config
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  hosts:
    kibana:
      host: kibana.local
      path: /

  tls:
    enabled: true
    secretName: logging-tls

# Consul integration
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1

# Authentik integration (ForwardAuth via Traefik)
authentik:
  enabled: false
  host: "https://authentik.local"
  outpostPath: "/outpost.goauthentik.io/auth/traefik"

# Vault integration
vault:
  enabled: false
  role: "logging"

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
