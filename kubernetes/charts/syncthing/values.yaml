# Namespace
namespace: data

create:
  namespace: true

# Syncthing Image
image:
  repository: syncthing/syncthing
  tag: "1.27.0"
  pullPolicy: IfNotPresent

# Syncthing conf
syncthing:
  replicaCount: 1

  # GUI Service
  service:
    gui:
      type: ClusterIP
      port: 8384
    # Sync Service (TCP)
    sync:
      type: ClusterIP
      port: 22000
    # Discovery Service (UDP)
    discovery:
      type: ClusterIP
      port: 21027

  resources:
    limits:
      cpu: 1000m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  # Conf Syncthing
  config:
    # GUI Configuration
    gui:
      enabled: true
      address: "0.0.0.0:8384"
      tls: false
      # Install password UI after first login
      authentication: false

    # Sync Configuration
    sync:
      listenAddresses:
        - "tcp://0.0.0.0:22000"
        - "quic://0.0.0.0:22000"
      maxConcurrentScans: 0
      maxSendKbps: 0
      maxRecvKbps: 0

    # Discovery
    discovery:
      enabled: true
      globalEnabled: true
      searchEnabled: true
      upgradeToEncryption: false

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Config directory (/var/syncthing/config)
  config:
    enabled: true
    size: 5Gi
    mountPath: /var/syncthing/config
    accessMode: ReadWriteOnce

  # Synced files directory (/var/syncthing/Sync)
  sync:
    enabled: true
    size: 1Gi
    mountPath: /var/syncthing/Sync
    accessMode: ReadWriteOnce

# Ingress through Traefik for GUI
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"

  host: syncthing.local
  path: /

  tls:
    enabled: true
    secretName: syncthing-tls

# Network Policy for Syncthing sync ports
networkPolicy:
  enabled: true
  allowNodePort: true

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - syncthing
    - file-sync

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    path: "/"
    port: 8384
    initialDelaySeconds: 30
    periodSeconds: 10
  readiness:
    enabled: true
    path: "/"
    port: 8384
    initialDelaySeconds: 10
    periodSeconds: 5

# Vault integration (requires Vault policies and secrets to be configured)
# Authentik integration (ForwardAuth via Traefik)
authentik:
  enabled: false
  middleware: "service-authentik-forward-auth@kubernetescrd"
  host: "https://authentik.local"
  outpostPath: "/outpost.goauthentik.io/auth/traefik"

vault:
  enabled: false
  # Note: Before enabling, configure Vault:
  # 1. Create policy for syncthing service
  # 2. Create secret at secret/data/syncthing/secrets
  # 3. Enable Kubernetes auth method in Vault
  # 4. Create role binding ServiceAccount to Vault policy
  # See: kubernetes/docs/VAULT_MIGRATION.md

# Sync config folder
folders:
  enabled: true
  folders:
    - id: "default"
      label: "Default Sync Folder"
      path: "/var/syncthing/Sync/default"
      rescanIntervalS: 3600
      ignorePerms: false
      autoNormalize: true
      filesystemType: "basic"

# Devices (another Syncthing nodes for sync)
devices:
  enabled: false
  # Sample:
  # - name: "other-node"
  #   deviceID: "XXXXX-XXXXX-XXXXX-XXXXX-XXXXX-XXXXX-XXXXX-XXXXX"
  #   address: "dynamic"
  #   compression: "metadata"
