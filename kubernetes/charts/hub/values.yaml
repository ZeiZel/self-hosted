# Namespace
namespace: code

create:
  namespace: true

# Hub Image
image:
  repository: jetbrains/hub
  tag: "2025.1"
  pullPolicy: IfNotPresent

# Hub Server
hub:
  replicaCount: 1

  service:
    type: ClusterIP
    port: 8080

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  # Конфигурация Hub
  config:
    baseUrl: "http://hub.local"
    listenPort: 8080

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Data
  data:
    enabled: true
    size: 1Gi
    mountPath: /opt/hub/data

  # Config
  config:
    enabled: true
    size: 1Gi
    mountPath: /opt/hub/conf

  # Logs
  logs:
    enabled: true
    size: 1Gi
    mountPath: /opt/hub/logs

# PostgreSQL (внешний)
postgresql:
  external: true
  host: "postgresql.db.svc.cluster.local"
  port: 5432
  username: "hub"
  password: "changeme"
  database: "hub"
  ssl: false

# Ingress через Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  host: hub.local
  path: /

  tls:
    enabled: true
    secretName: hub-tls

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10
  readiness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 5

# Vault integration (requires Vault policies and secrets to be configured)
vault:
  enabled: false
  # Note: Before enabling, configure Vault:
  # 1. Create policy for hub service
  # 2. Create secret at secret/data/hub/secrets
  # 3. Enable Kubernetes auth method in Vault
  # 4. Create role binding ServiceAccount to Vault policy
  # See: kubernetes/docs/VAULT_MIGRATION.md
