# Namespace
namespace: code

# YouTrack Image
image:
  repository: jetbrains/youtrack
  tag: "2024.3"
  pullPolicy: IfNotPresent

# YouTrack Server конфигурация
youtrack:
  replicaCount: 1

  service:
    type: ClusterIP
    port: 8080

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  # Конфигурация YouTrack
  config:
    baseUrl: "http://youtrack.local"
    listenPort: 8080
    jvmOptions: "-Xmx1024m"

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Data directory
  data:
    enabled: true
    size: 50Gi
    mountPath: /opt/youtrack/data
    accessMode: ReadWriteOnce

  # Backups directory
  backups:
    enabled: true
    size: 30Gi
    mountPath: /opt/youtrack/backups
    accessMode: ReadWriteOnce

  # Logs directory
  logs:
    enabled: true
    size: 10Gi
    mountPath: /opt/youtrack/logs
    accessMode: ReadWriteOnce

# Hub интеграция (для SSO)
hub:
  enabled: true
  host: "hub.authentik.svc.cluster.local"
  port: 8080
  # Или используйте DNS:
  # host: "hub.example.com"

# Authentik интеграция (через Hub)
authentik:
  enabled: true
  hubIntegration: true  # SSO через Hub

# GitLab интеграция
gitlab:
  enabled: true
  host: "gitlab.code.svc.cluster.local"
  # Или используйте DNS:
  # host: "gitlab.example.com"
  port: 80

  # Personal Access Token для GitLab
  token: "changeme"

  # Integration settings
  integration:
    cicd: true  # GitLab CI/CD integration
    webhooks: true

# Ingress через Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"

  host: youtrack.local
  path: /

  tls:
    enabled: true
    secretName: youtrack-tls

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - youtrack
    - issue-tracking

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 180
    periodSeconds: 20
  readiness:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10

# Environment variables
env:
  YOUTRACK_BASE_URL: "http://youtrack.local"
  YOUTRACK_LISTEN_PORT: "8080"
