replicaCount: 1

image:
  repository: ghcr.io/toeverything/affine-graphql
  pullPolicy: IfNotPresent
  tag: "stable"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false

service:
  type: ClusterIP
  port: 3010
  targetPort: 3010

ingress:
  enabled: true
  className: traefik
  annotations: {}
  hosts:
    - host: affine.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

persistence:
  enabled: true
  storageClass: openebs-hostpath
  accessMode: ReadWriteOnce
  size: 10Gi
  mountPath: /root/.affine/storage

# External PostgreSQL configuration
postgresql:
  enabled: false
  external:
    host: postgresql.db.svc.cluster.local
    port: 5432
    username: affine
    password: ""
    database: affine
    ssl: false

# External Redis (ValKey) configuration
redis:
  enabled: false
  external:
    host: valkey-master.db.svc.cluster.local
    port: 6379
    password: ""
    database: 0

# S3 Storage (Minio) configuration
s3:
  enabled: true
  endpoint: http://minio.db.svc.cluster.local:9000
  region: us-east-1
  bucket: affine
  accessKey: minioadmin
  secretKey: minioadmin
  forcePathStyle: true

# AFFiNE specific configuration
affine:
  serverName: AFFiNE
  host: "0.0.0.0"
  port: 3010
  https: false
  
  # Feature flags
  features:
    earlyAccess: false
    
  # Authentication
  auth:
    enableSignup: true
    enablePassword: true
    
  # Server configuration
  server:
    host: affine.local
    externalUrl: http://affine.local

# Consul integration
consul:
  enabled: true
  host: "consul-server.service.svc.cluster.local:8500"
  serviceName: affine
  servicePort: 3010
  datacenter: dc1
  tags:
    - affine

nodeSelector: {}

tolerations: []

affinity: {}

livenessProbe:
  httpGet:
    path: /api/healthz
    port: 3010
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/healthz
    port: 3010
  initialDelaySeconds: 15
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Authentik integration (ForwardAuth via Traefik)
authentik:
  enabled: false
  middleware: "service-authentik-forward-auth@kubernetescrd"
  host: "https://authentik.local"
  outpostPath: "/outpost.goauthentik.io/auth/traefik"

