apiVersion: v1
kind: Secret
metadata:
  name: {{ include "postgresql.secretName" . }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "postgresql.labels" . | nindent 4 }}
type: Opaque
stringData:
  POSTGRES_PASSWORD: {{ .Values.postgresql.config.superuserPassword }}
  POSTGRES_USER: {{ .Values.postgresql.config.superuser }}
  POSTGRES_DB: {{ .Values.postgresql.config.database }}

  {{- if .Values.patroni.enabled }}
  PATRONI_CONSUL_HOST: {{ .Values.patroni.consulConfig.host }}
  PATRONI_CONSUL_PORT: "{{ .Values.patroni.consulConfig.port }}"
  {{- end }}

  {{- if .Values.backup.pgbackrest.enabled }}
  PGBACKREST_REPO1_S3_BUCKET: {{ .Values.backup.pgbackrest.storage.s3Bucket }}
  PGBACKREST_REPO1_S3_ENDPOINT: {{ .Values.backup.pgbackrest.storage.s3Endpoint }}
  PGBACKREST_REPO1_S3_KEY: {{ .Values.backup.pgbackrest.storage.s3AccessKey }}
  PGBACKREST_REPO1_S3_KEY_SECRET: {{ .Values.backup.pgbackrest.storage.s3SecretKey }}
  {{- end }}

  {{- if .Values.pgadmin.enabled }}
  PGADMIN_DEFAULT_EMAIL: {{ .Values.pgadmin.config.email }}
  PGADMIN_DEFAULT_PASSWORD: {{ .Values.pgadmin.config.password }}
  {{- end }}
