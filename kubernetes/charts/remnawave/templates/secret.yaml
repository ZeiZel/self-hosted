apiVersion: v1
kind: Secret
metadata:
  name: {{ include "remnawave.fullname" . }}
  labels:
    {{- include "remnawave.labels" . | nindent 4 }}
type: Opaque
stringData:
  # PostgreSQL
  POSTGRES_USER: {{ .Values.postgresql.external.username | quote }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.external.password | quote }}
  POSTGRES_DB: {{ .Values.postgresql.external.database | quote }}
  DATABASE_URL: {{ include "remnawave.databaseUrl" . | quote }}

  # Redis (ValKey)
  REDIS_HOST: {{ .Values.redis.external.host | quote }}
  REDIS_PORT: {{ .Values.redis.external.port | quote }}
  {{- if .Values.redis.external.password }}
  REDIS_PASSWORD: {{ .Values.redis.external.password | quote }}
  {{- end }}
  REDIS_DB: {{ .Values.redis.external.database | quote }}

  # JWT Secrets
  JWT_AUTH_SECRET: {{ .Values.remnawave.jwt.authSecret | quote }}
  JWT_API_TOKENS_SECRET: {{ .Values.remnawave.jwt.apiTokensSecret | quote }}

  # Metrics
  METRICS_PASS: {{ .Values.remnawave.metrics.password | quote }}

  {{- if .Values.remnawave.telegram.enabled }}
  # Telegram
  TELEGRAM_BOT_TOKEN: {{ .Values.remnawave.telegram.botToken | quote }}
  {{- if .Values.remnawave.telegram.usersChatId }}
  TELEGRAM_NOTIFY_USERS_CHAT_ID: {{ .Values.remnawave.telegram.usersChatId | quote }}
  {{- end }}
  {{- if .Values.remnawave.telegram.nodesChatId }}
  TELEGRAM_NOTIFY_NODES_CHAT_ID: {{ .Values.remnawave.telegram.nodesChatId | quote }}
  {{- end }}
  {{- if .Values.remnawave.telegram.crmChatId }}
  TELEGRAM_NOTIFY_CRM_CHAT_ID: {{ .Values.remnawave.telegram.crmChatId | quote }}
  {{- end }}
  {{- end }}

  {{- if .Values.remnawave.webhook.enabled }}
  # Webhook
  WEBHOOK_URL: {{ .Values.remnawave.webhook.url | quote }}
  {{- if .Values.remnawave.webhook.secretHeader }}
  WEBHOOK_SECRET_HEADER: {{ .Values.remnawave.webhook.secretHeader | quote }}
  {{- end }}
  {{- end }}

  {{- if .Values.authentik.enabled }}
  # Authentik OIDC
  OIDC_ISSUER: {{ .Values.authentik.issuer | quote }}
  OIDC_CLIENT_ID: {{ .Values.authentik.clientId | quote }}
  OIDC_CLIENT_SECRET: {{ .Values.authentik.clientSecret | quote }}
  {{- end }}
