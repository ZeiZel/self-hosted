# Namespace
namespace: data

create:
  namespace: true

# OwnCloud Image
image:
  repository: owncloud/server
  tag: "11.0.0"
  pullPolicy: IfNotPresent

# OwnCloud Web Server config
owncloud:
  replicaCount: 1

  service:
    type: ClusterIP
    port: 8080

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  # Admin config
  admin:
    user: "admin"
    password: "changeme"

  # OwnCloud Config
  config:
    domain: "owncloud.local"
    protocol: "http"
    trustedDomains: []
    defaultLanguage: "en"

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Files directory
  files:
    enabled: true
    size: 1Gi
    mountPath: /mnt/data
    accessMode: ReadWriteOnce

  # Config directory
  config:
    enabled: true
    size: 5Gi
    mountPath: /etc/owncloud
    accessMode: ReadWriteOnce

# PostgreSQL (external)
postgresql:
  external: true
  host: "postgresql.code.svc.cluster.local"
  port: 5432
  username: "owncloud"
  password: "changeme"
  database: "owncloud"
  ssl: false

# Redis/ValKey (external) - session cache
redis:
  enabled: true
  host: "valkey-master.code.svc.cluster.local"
  port: 6379
  password: ""
  database: 0

# Ingress through Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"

  host: owncloud.local
  path: /

  tls:
    enabled: true
    secretName: owncloud-tls

# Cron Jobs config
cronjobs:
  enabled: true
  schedule: "*/15 * * * *"  # every 15 minutes
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 250m
      memory: 128Mi

# Consul integration
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - owncloud
    - file-sharing

# Security
securityContext:
  runAsUser: 33  # www-data user
  runAsGroup: 33
  fsGroup: 33

# Health Checks
probes:
  liveness:
    enabled: true
    path: "/status.php"
    initialDelaySeconds: 60
    periodSeconds: 10
  readiness:
    enabled: true
    path: "/status.php"
    initialDelaySeconds: 30
    periodSeconds: 5

# Environment variables
env:
  OWNCLOUD_LOG_LEVEL: "2"
  OWNCLOUD_APPS_ENABLE: "files,admin,comments,notifications,search,sharing,checksums,dav,oauth2"
