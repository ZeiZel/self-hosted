# Namespace
namespace: code

# TeamCity Server Image
server:
  image:
    repository: jetbrains/teamcity-server
    tag: "2024.03"
    pullPolicy: IfNotPresent

  replicaCount: 1

  service:
    type: ClusterIP
    port: 8111

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  # Persistent Storage
  persistence:
    enabled: true
    storageClass: standard
    size: 50Gi
    mountPath: /data/teamcity_server/datadir

# TeamCity Agent Image
agent:
  image:
    repository: jetbrains/teamcity-agent
    tag: "2024.03"
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 9090

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  # Persistent Storage для агентов
  persistence:
    enabled: true
    storageClass: standard
    size: 30Gi
    mountPath: /data/teamcity_agent/work

# PostgreSQL (внешний)
postgresql:
  external: true
  host: "postgresql.code.svc.cluster.local"
  port: 5432
  username: "teamcity"
  password: "changeme"
  database: "teamcity"
  ssl: false

# Ingress через Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  host: teamcity.local
  path: /

  tls:
    enabled: true
    secretName: teamcity-tls

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 180
    periodSeconds: 20
  readiness:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10
