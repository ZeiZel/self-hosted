# Namespace
namespace: data

# Nextcloud Image
image:
  repository: nextcloud/server
  tag: "latest"
  pullPolicy: IfNotPresent

# Nextcloud Web Server config
nextcloud:
  replicaCount: 1

  service:
    type: ClusterIP
    port: 8080

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  # Admin config
  admin:
    user: "admin"
    password: "changeme"

  # Nextcloud Config
  config:
    domain: "nextcloud.local"
    protocol: "http"
    trustedDomains: []
    defaultLanguage: "en"

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Files directory
  files:
    enabled: true
    size: 1Gi
    mountPath: /var/www/html/data
    accessMode: ReadWriteOnce

  # Config directory
  config:
    enabled: true
    size: 5Gi
    mountPath: /var/www/html/config
    accessMode: ReadWriteOnce

# PostgreSQL (external)
postgresql:
  external: true
  host: "postgresql.db.svc.cluster.local"
  port: 5432
  username: "nextcloud"
  password: "changeme"
  database: "nextcloud"
  ssl: false

# Redis/ValKey (external) - session cache
redis:
  enabled: true
  host: "valkey-master.db.svc.cluster.local"
  port: 6379
  password: ""
  database: "0"

# Ingress through Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"

  host: nextcloud.local
  path: /

  tls:
    enabled: true
    secretName: nextcloud-tls

# Cron Jobs config
cronjobs:
  enabled: true
  schedule: "*/15 * * * *"  # every 15 minutes
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 250m
      memory: 128Mi

# Consul integration
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - nextcloud
    - file-sharing

# Security
securityContext:
  runAsUser: 33  # www-data user
  runAsGroup: 33
  fsGroup: 33

# Health Checks
probes:
  liveness:
    enabled: true
    path: "/status.php"
    initialDelaySeconds: 60
    periodSeconds: 10
  readiness:
    enabled: true
    path: "/status.php"
    initialDelaySeconds: 30
    periodSeconds: 5

# Environment variables
env:
  NEXTCLOUD_LOG_LEVEL: "2"

# Vault integration (requires Vault policies and secrets to be configured)
vault:
  enabled: false
  # Note: Before enabling, configure Vault:
  # 1. Create policy for nextcloud service
  # 2. Create secret at secret/data/nextcloud/secrets
  # 3. Enable Kubernetes auth method in Vault
  # 4. Create role binding ServiceAccount to Vault policy
  # See: kubernetes/docs/VAULT_MIGRATION.md

