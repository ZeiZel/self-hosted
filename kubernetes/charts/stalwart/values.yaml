# Namespace
namespace: mailer

# Stalwart Image
image:
  repository: stalwartlabs/mail-server
  tag: "latest"
  pullPolicy: IfNotPresent

# Stalwart Server конфигурация
stalwart:
  replicaCount: 1

  # Services ports
  service:
    type: ClusterIP
    # HTTP/HTTPS ports
    http:
      port: 80
    https:
      port: 443
    # Mail ports
    smtp:
      port: 25
    submission:
      port: 587
    smtps:
      port: 465
    imap:
      port: 143
    imaps:
      port: 993
    pop3:
      port: 110
    pop3s:
      port: 995
    managesieve:
      port: 4190

  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 1000m
      memory: 1Gi

  # Конфигурация Stalwart
  config:
    # Domain configuration
    domain: "mail.local"
    hostnames:
      - "mail.local"
      - "smtp.mail.local"

    # TLS
    tls:
      enabled: true
      selfSigned: true

    # SMTP configuration
    smtp:
      greeting: "Welcome to Stalwart Mail Server"
      maxSize: 52428800  # 50MB

    # IMAP configuration
    imap:
      enabled: true

    # JMAP configuration
    jmap:
      enabled: true

    # WebUI
    webui:
      enabled: true
      port: 443

    # Rate limiting
    rateLimiting:
      enabled: true
      maxConnections: 100

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # Data directory (SQLite database, blobs, etc)
  data:
    enabled: true
    size: 50Gi
    mountPath: /opt/stalwart/data
    accessMode: ReadWriteOnce

  # Config directory
  config:
    enabled: true
    size: 5Gi
    mountPath: /opt/stalwart/config
    accessMode: ReadWriteOnce

# PostgreSQL (для интеграции)
postgresql:
  enabled: false
  external: true
  host: "postgresql.code.svc.cluster.local"
  port: 5432
  username: "stalwart"
  password: "changeme"
  database: "stalwart"

# Redis/ValKey (для кэширования и сессий)
redis:
  enabled: false
  host: "valkey-master.code.svc.cluster.local"
  port: 6379
  password: ""

# LDAP Authentication (Authentik)
ldap:
  enabled: true
  host: "authentik-ldap.authentik.svc.cluster.local"  # Authentik LDAP interface
  port: 389
  bindDN: "cn=admin,dc=authentik,dc=local"
  bindPassword: "changeme"
  baseDN: "ou=users,dc=authentik,dc=local"
  # User search filter
  userFilter: "(&(objectClass=user)(uid={username}))"
  usernameAttribute: "uid"
  emailAttribute: "mail"
  displayNameAttribute: "cn"
  # Bind authentication method
  authMethod: "bind"  # bind, template, или lookup

# Ingress через Traefik (для WebUI)
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  host: mail.local
  path: /

  tls:
    enabled: true
    secretName: stalwart-tls

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - stalwart
    - mail-server
    - smtp
    - imap

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10
  readiness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 5

# NodePort для mail портов (опционально)
nodePort:
  enabled: false
  smtp: 25
  submission: 587
  smtps: 465
  imap: 143
  imaps: 993
  pop3: 110
  pop3s: 995
