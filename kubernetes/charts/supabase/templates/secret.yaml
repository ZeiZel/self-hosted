{{- if not .Values.jwt.existingSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "supabase.fullname" . }}-jwt
  labels:
    {{- include "supabase.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.jwt.secret }}
  jwt-secret: {{ .Values.jwt.secret | b64enc | quote }}
  {{- else }}
  jwt-secret: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
  {{- if .Values.jwt.anonKey }}
  anon-key: {{ .Values.jwt.anonKey | b64enc | quote }}
  {{- else }}
  anon-key: {{ "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0" | b64enc | quote }}
  {{- end }}
  {{- if .Values.jwt.serviceRoleKey }}
  service-role-key: {{ .Values.jwt.serviceRoleKey | b64enc | quote }}
  {{- else }}
  service-role-key: {{ "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU" | b64enc | quote }}
  {{- end }}
{{- end }}

{{- if not .Values.postgresql.existingSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "supabase.fullname" . }}-postgresql
  labels:
    {{- include "supabase.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.postgresql.password }}
  postgres-password: {{ .Values.postgresql.password | b64enc | quote }}
  {{- else }}
  postgres-password: {{ "postgres" | b64enc | quote }}
  {{- end }}
  connection-uri: {{ printf "postgresql://%s:%s@%s:%d/%s" .Values.postgresql.user (.Values.postgresql.password | default "postgres") .Values.postgresql.host (int .Values.postgresql.port) .Values.postgresql.database | b64enc | quote }}
{{- end }}

{{- if not .Values.minio.existingSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "supabase.fullname" . }}-minio
  labels:
    {{- include "supabase.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.minio.accessKey }}
  access-key: {{ .Values.minio.accessKey | b64enc | quote }}
  {{- else }}
  access-key: {{ "minio" | b64enc | quote }}
  {{- end }}
  {{- if .Values.minio.secretKey }}
  secret-key: {{ .Values.minio.secretKey | b64enc | quote }}
  {{- else }}
  secret-key: {{ "minioSecurePassword123" | b64enc | quote }}
  {{- end }}
{{- end }}

{{- if not .Values.redis.existingSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "supabase.fullname" . }}-redis
  labels:
    {{- include "supabase.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.redis.password }}
  redis-password: {{ .Values.redis.password | b64enc | quote }}
  {{- else }}
  redis-password: {{ "" | b64enc | quote }}
  {{- end }}
{{- end }}

---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "supabase.fullname" . }}-realtime
  labels:
    {{- include "supabase.labels" . | nindent 4 }}
type: Opaque
data:
  db-enc-key: {{ randAlphaNum 32 | b64enc | quote }}
  secret-key-base: {{ randAlphaNum 64 | b64enc | quote }}
