# Namespace
namespace: service

create:
  namespace: true

# Prometheus config
prometheus:
  enabled: true
  image: prom/prometheus:latest
  replicaCount: 1

  service:
    type: ClusterIP
    port: 9090

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

  persistence:
    enabled: true
    storageClass: standard
    size: 3Gi
    mountPath: /prometheus

  # Retention
  retention: 30d
  retentionSize: "25GB"

  # Scrape intervals
  globalScrapeInterval: 30s
  globalEvaluationInterval: 30s

# Loki config
loki:
  enabled: true
  image: grafana/loki:latest
  replicaCount: 1

  service:
    type: ClusterIP
    port: 3100

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  persistence:
    enabled: true
    storageClass: standard
    size: 2Gi
    mountPath: /loki

  # Retention
  retention_period: 720h  # 30 дней
  max_chunk_age: 2h

# Promtail config (Log collector)
promtail:
  enabled: true
  image: grafana/promtail:latest

  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 64Mi

# Grafana config
grafana:
  enabled: true
  image: grafana/grafana:latest
  replicaCount: 1

  service:
    type: ClusterIP
    port: 3000

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  persistence:
    enabled: true
    storageClass: standard
    size: 5Gi
    mountPath: /var/lib/grafana

  # Admin config
  admin:
    user: admin
    password: "changeme"

  # Theme
  theme: dark

  # Plugins
  plugins: []

# Ingress config
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  hosts:
    prometheus:
      host: prometheus.local
      path: /
    loki:
      host: loki.local
      path: /
    grafana:
      host: grafana.local
      path: /

  tls:
    enabled: true
    secretName: monitoring-tls

# Consul integration
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1

# Pod Anti-affinity for multi-node deployment
affinity:
  podAntiAffinity:
    enabled: false
    type: preferredDuringSchedulingIgnoredDuringExecution

# Security
securityContext:
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

# Authentik integration (ForwardAuth via Traefik)
authentik:
  enabled: false
  middleware: "service-authentik-forward-auth@kubernetescrd"
  host: "https://authentik.local"
  outpostPath: "/outpost.goauthentik.io/auth/traefik"

