# Headless Service for StatefulSet
apiVersion: v1
kind: Service
metadata:
  name: consul-headless
  namespace: {{ .Release.Namespace }}
  labels:
    app: consul
spec:
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - port: 8500
      targetPort: 8500
      name: http
    - port: 8301
      targetPort: 8301
      name: serf-lan
    - port: 8302
      targetPort: 8302
      name: serf-wan
    - port: 8300
      targetPort: 8300
      name: server
  selector:
    app: consul
    component: server

---
# UI Service (ClusterIP)
apiVersion: v1
kind: Service
metadata:
  name: consul
  namespace: {{ .Release.Namespace }}
  labels:
    app: consul
spec:
  type: {{ .Values.server.service.type }}
  ports:
    - port: {{ .Values.server.service.port }}
      targetPort: 8500
      name: http
    - port: 8301
      targetPort: 8301
      name: serf-lan
    - port: 8302
      targetPort: 8302
      name: serf-wan
    - port: 8300
      targetPort: 8300
      name: server
    - port: 8600
      targetPort: 8600
      name: dns
  selector:
    app: consul
    component: server

---
# DNS Service
apiVersion: v1
kind: Service
metadata:
  name: consul-dns
  namespace: {{ .Release.Namespace }}
  labels:
    app: consul
spec:
  type: ClusterIP
  ports:
    - port: 53
      targetPort: 8600
      protocol: UDP
      name: dns
    - port: 53
      targetPort: 8600
      protocol: TCP
      name: dns-tcp
  selector:
    app: consul
    component: server
