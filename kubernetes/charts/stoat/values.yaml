# Namespace
namespace: code

# Revolt Backend (API) Image
api:
  image:
    repository: revoltchat/server
    tag: "latest"
    pullPolicy: IfNotPresent

  replicaCount: 1

  service:
    type: ClusterIP
    port: 8000

  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi

# Revolt Frontend (Web) Image
web:
  image:
    repository: revoltchat/web
    tag: "latest"
    pullPolicy: IfNotPresent

  replicaCount: 1

  service:
    type: ClusterIP
    port: 3000

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

# Revolt конфигурация
revolt:
  config:
    # Domain configuration
    apiUrl: "http://api.revolt.local"
    appUrl: "http://revolt.local"
    publicUrl: "http://revolt.local"

    # Server name
    serverName: "Revolt"

    # Features
    features:
      inviteOnly: false
      emailVerification: false
      captcha: false

    # File upload
    fileUpload:
      maxSize: 20971520  # 20MB

    # Logging
    logLevel: "info"

# MongoDB (для Revolt)
mongodb:
  enabled: true
  external: true
  host: "mongodb-revolt.code.svc.cluster.local"
  port: 27017
  username: "revolt"
  password: "changeme"
  database: "revolt"
  authSource: "admin"

# Redis/ValKey (для кэширования)
redis:
  enabled: true
  host: "valkey-master.code.svc.cluster.local"
  port: 6379
  password: ""

# S3/MinIO (для хранения файлов)
s3:
  enabled: true
  endpoint: "http://minio.code.svc.cluster.local:9000"
  region: "us-east-1"
  accessKey: "minioadmin"
  secretKey: "minioadmin"
  bucket: "revolt"
  usePathStyle: true

# Persistent Storage
persistence:
  enabled: true
  storageClass: standard

  # API data
  data:
    enabled: true
    size: 50Gi
    mountPath: /data
    accessMode: ReadWriteOnce

# SAML2 Authentication (Authentik)
saml:
  enabled: true
  idpUrl: "http://authentik.authentik.svc.cluster.local"
  entrypoint: "http://authentik.authentik.svc.cluster.local/application/saml/revolt/sso/binding/redirect/"
  issuer: "http://revolt.local"
  cert: ""  # Поместить сертификат Authentik
  identifierFormat: "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"
  nameIDFormat: "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"

# Ingress через Traefik
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure

  # API Ingress
  api:
    host: api.revolt.local
    path: /

  # Web Ingress
  web:
    host: revolt.local
    path: /

  tls:
    enabled: true
    secretName: revolt-tls

# Consul интеграция
consul:
  enabled: true
  host: "consul.consul.svc.cluster.local"
  port: 8500
  datacenter: dc1
  tags:
    - revolt
    - chat-server

# Security
securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Health Checks
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10
  readiness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 5

# SMTP (for email notifications)
smtp:
  enabled: false
  host: "smtp.example.com"
  port: 587
  from: "noreply@revolt.local"
  username: ""
  password: ""
