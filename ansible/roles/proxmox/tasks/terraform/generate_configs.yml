---
# Generate Terraform configuration files from templates

- name: Ensure Terraform working directory exists
  file:
    path: "{{ terraform_working_dir }}"
    state: directory
    mode: '0755'

- name: Generate main Terraform configuration
  template:
    src: main.tf.j2
    dest: "{{ terraform_working_dir }}/main.tf"
    mode: '0644'

- name: Generate Terraform variables
  template:
    src: variables.tf.j2
    dest: "{{ terraform_working_dir }}/variables.tf"
    mode: '0644'

- name: Generate master VM configuration
  template:
    src: vm_master.tf.j2
    dest: "{{ terraform_working_dir }}/vm_master.tf"
    mode: '0644'

- name: Generate worker-db VM configuration
  template:
    src: vm_worker_db.tf.j2
    dest: "{{ terraform_working_dir }}/vm_worker_db.tf"
    mode: '0644'

- name: Generate worker-services VM configuration
  template:
    src: vm_worker_services.tf.j2
    dest: "{{ terraform_working_dir }}/vm_worker_services.tf"
    mode: '0644'

- name: Generate worker-apps VM configuration
  template:
    src: vm_worker_apps.tf.j2
    dest: "{{ terraform_working_dir }}/vm_worker_apps.tf"
    mode: '0644'

- name: Generate Terraform outputs
  template:
    src: outputs.tf.j2
    dest: "{{ terraform_working_dir }}/outputs.tf"
    mode: '0644'

- name: Display generated files
  debug:
    msg: |
      Terraform configuration generated:
        - {{ terraform_working_dir }}/main.tf
        - {{ terraform_working_dir }}/variables.tf
        - {{ terraform_working_dir }}/vm_master.tf
        - {{ terraform_working_dir }}/vm_worker_db.tf
        - {{ terraform_working_dir }}/vm_worker_services.tf
        - {{ terraform_working_dir }}/vm_worker_apps.tf
        - {{ terraform_working_dir }}/outputs.tf
