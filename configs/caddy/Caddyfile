(port_vars) {
  vars {
    core_domain      {$CORE_DOMAIN:localhost}
    dashy_port       {$DASHY_OUT_PORT:4000}
    youtrack_port    {$YOUTRACK_OUT_PORT:4001}
    gitlab_port      {$GITLAB_OUT_PORT:4002}
    www_port         {$WWW_OUT_PORT:4003}
    mail_port        {$MAIL_OUT_PORT:4004}
    notesnook_port   {$NOTESNOOK_OUT_PORT:4014}
    authn_port       {$AUTHENTIK_OUT_PORT:4011}
  }
}

{$CORE_DOMAIN:localhost}:80  {
    import port_vars

    route /mail* {
        reverse_proxy localhost:{mail_port}
    }

    route /dashy* {
        reverse_proxy localhost:{dashy_port}
    }
}

www.{$CORE_DOMAIN:localhost} {
    import port_vars
    reverse_proxy localhost:{www_port}
}

youtrack.{$CORE_DOMAIN:localhost} {
    import port_vars
    reverse_proxy localhost:{youtrack_port}
}

gitlab.{$CORE_DOMAIN:localhost} {
    import port_vars
    reverse_proxy localhost:{gitlab_port}
}

notesnook.{$CORE_DOMAIN:localhost} {
    import port_vars
    reverse_proxy localhost:{notesnook_port}
}

auth.{$CORE_DOMAIN:localhost} {
    import port_vars
    reverse_proxy localhost:{authn_port}
}

revolt.{$CORE_DOMAIN:localhost} {
    route /api* {
        uri strip_prefix /api
        reverse_proxy http://api:14702
    }

    route /ws {
        uri strip_prefix /ws
        reverse_proxy http://events:14703
    }

    route /autumn* {
        uri strip_prefix /autumn
        reverse_proxy http://autumn:14704
    }

    route /january* {
        uri strip_prefix /january
        reverse_proxy http://january:14705
    }

    reverse_proxy http://web:5000
}

monitoring.{$CORE_DOMAIN:localhost} {
    route /prometheus* {
        reverse_proxy localhost:9000
    }

    route /grafana* {
        reverse_proxy localhost:9001
    }

    route /alert* {
        reverse_proxy localhost:9002
    }

    route /pushgw* {
        reverse_proxy localhost:9003
    }
}
