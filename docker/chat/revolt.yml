---
name: revolt

services:
  # API server
  api:
    image: ghcr.io/revoltchat/server:20250210-1
    restart: always
    depends_on:
      database:
        condition: service_healthy
      redis:
        condition: service_started
      rabbit:
        condition: service_healthy
    volumes:
      - type: bind
        source: ./Revolt.toml
        target: /Revolt.toml

  # Events service
  events:
    image: ghcr.io/revoltchat/bonfire:20250210-1
    depends_on:
      database:
        condition: service_healthy
      redis:
        condition: service_started
    volumes:
      - type: bind
        source: ./Revolt.toml
        target: /Revolt.toml
    restart: always

  # Web App
  web:
    image: ghcr.io/revoltchat/client:master
    restart: always
    env_file: .env.web

  # File server
  autumn:
    image: ghcr.io/revoltchat/autumn:20250210-1
    restart: always
    depends_on:
      database:
        condition: service_healthy
      createbuckets:
        condition: service_started
    volumes:
      - type: bind
        source: ./Revolt.toml
        target: /Revolt.toml

  # Metadata and image proxy
  january:
    image: ghcr.io/revoltchat/january:20250210-1
    restart: always
    volumes:
      - type: bind
        source: ./Revolt.toml
        target: /Revolt.toml

  # Push notification daemon
  pushd:
    image: ghcr.io/revoltchat/pushd:20250210-1
    restart: always
    depends_on:
      database:
        condition: service_healthy
      redis:
        condition: service_started
      rabbit:
        condition: service_healthy
    volumes:
      - type: bind
        source: ./Revolt.toml
        target: /Revolt.toml
